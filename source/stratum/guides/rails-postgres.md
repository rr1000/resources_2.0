---
title: Rails + Postgres Guide
category: guide
---

# Catalyze Rails - PostgreSQL Guide

## Introduction
This guide will walk you through an end-to-end roll-out of a Ruby on Rails app with logging, environment variables and connection to a PostgreSQL database hosted on the Catalyze platform. We assume that you already have a contract in place with us as well as a signed BAA. Please contact us if you need help or sign up for a [Free Trial][4].

You will start by creating your environment and linking your local app to our internal git repositories as outlined in our [Onboarding Guide][1]. Then you will add logging, environment variables and a PostgreSQL database to your app. Lastly you will commit your changes and push your app to the secure Catalyze platform.

## Setting up your local Rails app
We created an [example Ruby on Rails app][3] that connects to a PostgreSQL database to use as an example for this guide. This example was created by running `rails new ruby-example-app --database=postgresql`.

The example app does a few basic things:

- Connects to a PostgreSQL database
- Has a single route which both stores a counter and a timestamp in the database and also displays the most recent ten records
- Sends some example logs that will show up in the Catalyze environment's logging service

Feel free to use this example application as a base for your own, or just as a reference while you are developing. If you want more help with developing your application with Rails, the Ruby on Rails [Getting Started][7] guide is very useful.

## Adding logging to your Rails app
The Catalyze logging service keeps track of everything that is sent to STDOUT and STDERR, so the easiest way to add messages to your logs are to create loggers using [standard Ruby Logger][6] practices: `Logger.new(STDOUT)` or `Logger.new(STDERR)`. More information on how logging works in Catalyze environments is located [here][5].

## Onboarding and SSL/SSH setup
Once your local Rails application is up and running, you will need to complete the [Catalyze onboarding process][1] for your environment. The steps include setting up SSL Certificates, SSH Keys, and environment variables to ensure your environment can be built appropriately.

## Readying your application for deployment on Catalyze
There are a few things that need to be changed in order for your application to run appropriately on Catalyze. These steps have already been handled in the Ruby on Rails example application.

1. Create a file called "Procfile" which includes the following, which tells Catalyze how to run your application. The $PORT variable is automatically generated by Catalyze and must be present, otherwise your application will not run properly.

```
web: bundle exec rails server -p $PORT
```

2. Update your database connection information in config/database.yml to use the $DATABASE_URL environment variable that Catalyze automatically generates. Make sure you change the value of YOUR_DATABASE_NAME to the actual name of the database you want to connect to.

```
production:
  url: <%= ENV['DATABASE_URL'] %>
  database: YOUR_DATABASE_NAME
```

3. Ensure your application is committed into a git repository.

```
$ git init
$ git add .
$ git commit -m "Initial commit"
```

## Using the Catalyze Stratum CLI to connect your app to Stratum
Once Catalyze has provisioned your environment and you have made the appropriate changes to your application, you can associate your local git repository with your Catalyze environment, which will enable you to push your application to Catalyze. There is a [Catalyze Stratum CLI][8] available which makes interacting with your environment quite easy.

Once you have the Catalyze CLI installed, run the following command from within your application's directory, replacing YOUR_ENVIRONMENT_NAME with the name of your environment as displayed in the Stratum [Dashboard][9]. This adds a git remote to your local repository, which will allow you to push your code

```
$ catalyze associate YOUR_ENVIRONMENT_NAME app01
```

## Pushing your application to the Catalyze platform
The first time that you push your code to Catalyze, we require that you notify support@catalyze.io that you have pushed code and that your application finished building successfully. We will let you know when your application has finished the initial deployment. After the initial deployment, every time code is pushed to Catalyze using the command below, the application will be updated automatically.

To push your code to Catalyze, simply run the command below from within your application's directory.

```
$ git push catalyze master
```

## Preparing PostgreSQL for your application
While you are waiting for Catalyze to complete your initial deployment, you can set up your database and run appropriate migrations so that your application can connect to PostgreSQL. The [Catalyze Stratum CLI][8] can be used to connect to your database and run commands. Below is an example of how to run db:setup on PostgreSQL to create your database, tables, etc. Make sure you change the value of YOUR_DATABASE_NAME to the actual name of the database you want to connect to. Note: your database service may be named something other than "db01" if you changed it in the Catalyze Dashboard.

```
$ catalyze rake db:setup
```

[1]: /stratum/getting-started 	"Getting Started Guide"
[2]: /paas/paas-cli-reference 	"CLI Reference"
[3]: https://github.com/catalyzeio/ruby-example-app 	"Ruby Example App"
[4]: https://catalyze.io/signup 	"Free Trial"
[5]: /stratum/articles/guides/application-logging/ "Logging"
[6]: http://ruby-doc.org/stdlib-1.9.3/libdoc/logger/rdoc/Logger.html "Ruby Logger"
[7]: http://guides.rubyonrails.org/getting_started.html "Ruby on Rails Getting Started"
[8]: https://github.com/catalyzeio/cli "Catalyze Stratum CLI"
[9]: https://stratum.catalyze.io "Catalyze Dashboard"
